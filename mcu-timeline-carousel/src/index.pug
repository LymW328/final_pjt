#app
    transition(name="carousel-fade" mode="out-in")
      .load-screen(v-if="loading" key="1")
        p Loading MCU Timeline

      .load-screen(v-else-if="!loading && error" key="2")
        p Timeline could not assemble
        
      main.main-screen(v-else key="3" :class="{ 'show-modal' : showModal }")
        carousel(v-if="movies.length" :class="scrollDirection" :options="carouselOptions" :movies="movies" :current="current" @scroll-direction="handleScrollDirection" @set-current="handleCurrentSlide" @trigger-modal="handleModal")

        transition(name="modal")
          modal(v-if="showModal" :id="movies[current].id" @trigger-modal="handleModal")

// Component templates
template#tpl__carousel
  .carousel
    .image__viewport
      transition(name="fade" mode="out-in")
        carousel-image.carousel__image(v-if="index === current" v-for="movie, index in movies" :backdrop="movie.backdrop_path" size="1280" :key="movie.id")

    embla(ref="embla" :options="options")
      carousel-item(v-for="movie in movies" :title="movie.title" :key="movie.id" v-on="$listeners")

    transition(name="fade")
      button.btn.btn--prev(v-if="canScrollPrev()" @click="scrollPrev")
        svg.icon--control(viewBox="0 0 24 24")
          path(d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z")

    transition(name="fade")
      button.btn.btn--next(v-if="canScrollNext()" @click="scrollNext")
        svg.icon--control(viewBox="0 0 24 24")
          path(d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z")
          
    .timeline
      .dot(v-for="movie, index in movies" :class="{ current : index === current }" @click="scrollTo(index)")
        .dot__image-wrapper
          carousel-image(:backdrop="movie.poster_path" size="154" :key="movie.id")

template#tpl__embla
  .carousel__viewport
    .carousel__container
      slot

template#tpl__carousel-item
  li.carousel__slide
    h2.slide__title {{ title }}
    button.btn.btn--cta(@click="handleModal")
      svg.icon--play(viewBox="0 0 24 24")
        path(d="M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M10,16.5L16,12L10,7.5V16.5Z")
      span Watch trailer

template#tpl__carousel-image
  img(:src="src")
  
template#tpl__modal
  .modal
    .modal__overlay(@click="handleModal")
    .modal__wrapper
      iframe(v-if="src" :src="src" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen)
      button.btn.btn--close(title="Close trailer window" @click="handleModal")
        svg.icon--close(viewBox="0 0 24 24")
          path(d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z")